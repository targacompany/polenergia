document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("myChart");if(!t)return;const e=t.getContext("2d"),a=getComputedStyle(e.canvas.parentElement).color,r=t.closest(".section"),n=r&&r.classList.contains("theme-dark")?"#01EFA733":"#ffffff",o={id:"chartAreaBackgroundColor",beforeDraw:t=>{const{ctx:e,chartArea:a}=t;if(!a)return;const r=16,o=Math.max(0,a.top-1),i=Math.min(41,o),l=a.left+1,d=a.top-i+1,s=a.width-2,c=a.height+i-2,u=new Path2D;u.moveTo(l+r,d),u.lineTo(l+s-r,d),u.quadraticCurveTo(l+s,d,l+s,d+r),u.lineTo(l+s,d+c-r),u.quadraticCurveTo(l+s,d+c,l+s-r,d+c),u.lineTo(l+r,d+c),u.quadraticCurveTo(l,d+c,l,d+c-r),u.lineTo(l,d+r),u.quadraticCurveTo(l,d,l+r,d),u.closePath(),e.save(),e.fillStyle=n,e.fill(u),e.restore(),t.$customBorder={path:u,strokeColor:"#01EFA7",lineW:2}},afterDraw:t=>{const{ctx:e}=t;if(!t.$customBorder)return;const{path:a,strokeColor:r,lineW:n}=t.$customBorder;e.save(),e.strokeStyle=r,e.lineWidth=n,e.stroke(a),e.restore()}},i=[{start:"#061434",end:"#0B2665"},{start:"#01EFA7",end:"#03C389"}],l=new Chart(e,{type:"bar",data:{labels:["Rachunek teraz","Rachunek z zestawem"],datasets:[{label:"Koszt",data:[0,0],borderWidth:0,borderRadius:16,backgroundColor:t=>{const{chart:e,dataIndex:a}=t,{ctx:r,chartArea:n}=e,o=i[a];if(!o)return"#01EFA7";if(!n)return o.end;const l=r.createLinearGradient(n.left,0,n.right,0);return l.addColorStop(0,o.start),l.addColorStop(1,o.end),l}}]},options:{indexAxis:"x",plugins:{datalabels:{anchor:"end",align:"end",color:a,font:{weight:"600",size:18},formatter:t=>t.toLocaleString("pl-PL",{minimumFractionDigits:2,maximumFractionDigits:2})+" zÅ‚"},legend:{display:!1}},layout:{padding:{top:30}},scales:{x:{grid:{display:!1,drawBorder:!1},border:{display:!1},ticks:{font:{size:()=>window.innerWidth<460?11:14,weight:"600"},color:a,maxRotation:0,minRotation:0}},y:{beginAtZero:!0,min:0,grid:{display:!1},ticks:{display:!1},border:{display:!1}}},animation:{duration:600,easing:"easeOutQuart"}},plugins:[ChartDataLabels,o]});function d(){const t=document.getElementById("billInput"),e=document.getElementById("yearlyBill"),a=12*parseFloat(t?.value||0),r=null==(n=e?.dataset?.rawValue??e?.value??e?.textContent??0)?NaN:"number"==typeof n?n:"string"!=typeof n?Number(n):parseFloat(n.replace(/\s+/g,"").replace(",","."));var n;return{yearlyFromInput:a,yearlyBill:Number.isFinite(r)?r:0}}function s(){const{yearlyFromInput:t,yearlyBill:e}=d();l.data.datasets[0].data=[t,e],m&&l.update()}const c=document.getElementById("billInput"),u=document.getElementById("yearlyBill");if(c&&c.addEventListener("input",()=>s()),u){new MutationObserver(()=>s()).observe(u,{childList:!0,characterData:!0,subtree:!0})}let m=!1,p=!0;document.addEventListener("polenergia:calculator:update",t=>{if(t.detail){const e=document.getElementById("yearlyBill");e&&null!=t.detail.results?.firstYear?.pvBillWith&&(e.dataset.rawValue=String(t.detail.results.firstYear.pvBillWith))}s()}),document.addEventListener("polenergia:calculator:advanced",t=>{m=!!t.detail?.active,m?p?(p=!1,l.data.datasets[0].data=[0,0],l.update("none"),setTimeout(()=>s(),1e3)):s():(l.data.datasets[0].data=[0,0],l.update("none"))})});